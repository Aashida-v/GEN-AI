<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vediedu - Take Course</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000;
            overflow-x: hidden;
            overflow-y: auto;
        }
        .living-background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(-45deg, #134e5e, #71b280, #2dd4bf, #06b6d4, #3b82f6, #1e40af);
            background-size: 600% 600%;
            animation: livingGradient 12s ease infinite;
            z-index: -20;
        }
        @keyframes livingGradient {
            0% { background-position: 0% 50%; }
            25% { background-position: 100% 0%; }
            50% { background-position: 50% 100%; }
            75% { background-position: 0% 100%; }
            100% { background-position: 0% 50%; }
        }
        .orb {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.3), rgba(255,255,255,0.05));
            animation: floatOrb 8s ease-in-out infinite;
            backdrop-filter: blur(2px);
            z-index: -10;
        }
        @keyframes floatOrb {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(50px, -30px); }
            50% { transform: translate(-30px, 50px); }
            75% { transform: translate(-50px, -20px); }
        }
        .orb:nth-child(1) { width: 120px; height: 120px; top: 20%; left: 15%; animation-delay: 0s; }
        .orb:nth-child(2) { width: 80px; height: 80px; top: 60%; left: 80%; animation-delay: -2s; }
        .orb:nth-child(3) { width: 150px; height: 150px; top: 70%; left: 20%; animation-delay: -4s; }
        .orb:nth-child(4) { width: 100px; height: 100px; top: 10%; left: 70%; animation-delay: -6s; }
        .course-card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .progress-bar-container {
            height: 10px;
            background-color: #4b5563;
            border-radius: 5px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background-color: #2dd4bf;
            transition: width 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-black text-white min-h-screen flex flex-col p-4">
    <div class="living-background-container">
        <div class="orb"></div>
        <div class="orb"></div>
        <div class="orb"></div>
        <div class="orb"></div>
    </div>
    <header class="relative z-10 flex items-center justify-between p-4 mb-8 bg-gray-900/50 backdrop-blur-lg rounded-xl border-2 border-white/20">
        <a href="student_dashboard.html" class="text-white py-2 px-4 rounded-lg font-semibold hover:bg-white/10 transition-colors">
            &larr; Back to Courses
        </a>
        <h1 id="course-title-header" class="text-3xl font-bold text-white text-center flex-1">Take Course</h1>
        <div class="w-[124px]"></div>
    </header>

    <main class="relative z-10 flex-1 w-full max-w-4xl mx-auto p-4 flex flex-col items-center">
        <div id="course-content-container" class="course-card bg-gray-900/50 backdrop-blur-lg rounded-xl p-8 border-2 border-white/20 w-full mb-6">
            </div>

        <div id="progress-container" class="w-full max-w-4xl mb-6">
            <h3 class="text-white/70 text-sm mb-2">Course Progress: <span id="progress-text">0%</span></h3>
            <div class="progress-bar-container">
                <div id="progress-bar" class="progress-bar" style="width: 0%;"></div>
            </div>
        </div>

        <div id="completion-section" class="w-full max-w-4xl">
            <h3 class="text-xl font-semibold text-white mb-4 border-b border-gray-700 pb-2">Complete this course</h3>
            <div class="bg-gray-900/50 backdrop-blur-lg rounded-xl p-6 border-2 border-white/20">
                <p id="completion-message" class="text-gray-400 mb-4">You must complete all sections to get your certificate.</p>
                <label for="student-name" class="block text-white/70 mb-2">Enter your name for the certificate:</label>
                <input type="text" id="student-name" class="w-full px-4 py-2 rounded-lg bg-gray-800 text-white placeholder-gray-500 border border-gray-700 focus:outline-none focus:border-blue-500" placeholder="e.g., Jane Doe">
                <button id="generate-certificate-btn" class="w-full bg-yellow-500 text-white py-2 rounded-lg font-semibold hover:bg-yellow-600 transition-colors mt-4 hidden">
                    Generate Certificate
                </button>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const courseContentContainer = document.getElementById("course-content-container");
            const courseTitleHeader = document.getElementById("course-title-header");
            const studentNameInput = document.getElementById("student-name");
            const completionMessage = document.getElementById("completion-message");
            const generateCertificateBtn = document.getElementById("generate-certificate-btn");
            const progressBar = document.getElementById("progress-bar");
            const progressText = document.getElementById("progress-text");

            const params = new URLSearchParams(window.location.search);
            const courseId = params.get('id');

            if (!courseId) {
                courseContentContainer.innerHTML = '<p class="text-2xl text-red-500 text-center">Error: Course not found.</p>';
                return;
            }

            const courses = JSON.parse(localStorage.getItem('courses')) || [];
            const course = courses.find(c => c.courseId === courseId);
            
            let courseProgress = JSON.parse(localStorage.getItem(`progress_${courseId}`)) || { lectureRead: false, quizCompleted: false };
            const studentName = localStorage.getItem(`student_name_${courseId}`) || "";
            if (studentName) {
                studentNameInput.value = studentName;
            }

            function updateProgress() {
                let completedSteps = 0;
                if (courseProgress.lectureRead) completedSteps++;
                if (courseProgress.quizCompleted) completedSteps++;
                
                const totalSteps = 2;
                const progressPercentage = (completedSteps / totalSteps) * 100;
                
                progressBar.style.width = `${progressPercentage}%`;
                progressText.textContent = `${progressPercentage}%`;

                const checkmarkIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 inline-block -mt-1 mr-1">
                                            <path fill-rule="evenodd" d="M19.916 4.626a.75.75 0 0 1 .208 1.04l-9.5 13.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 8.85-12.631a.75.75 0 0 1 1.04-.208Z" clip-rule="evenodd" />
                                        </svg>`;

                const markLectureBtn = document.getElementById('mark-lecture-btn');
                const markQuizBtn = document.getElementById('mark-quiz-btn');

                if (courseProgress.lectureRead && markLectureBtn) {
                    markLectureBtn.innerHTML = `${checkmarkIcon} Completed`;
                    markLectureBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    markLectureBtn.classList.add('bg-green-600', 'hover:bg-green-700', 'cursor-not-allowed', 'pointer-events-none');
                }
                
                if (courseProgress.quizCompleted && markQuizBtn) {
                    markQuizBtn.innerHTML = `${checkmarkIcon} Completed`;
                    markQuizBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                    markQuizBtn.classList.add('bg-green-600', 'hover:bg-green-700', 'cursor-not-allowed', 'pointer-events-none');
                }

                if (progressPercentage === 100) {
                    completionMessage.textContent = "You have completed this course!";
                    if (course.issueCertificate) {
                        generateCertificateBtn.classList.remove('hidden');
                    } else {
                        completionMessage.textContent = "You have completed this course. A certificate is not issued for this course.";
                    }
                }
            }

            if (course) {
                courseTitleHeader.textContent = `Taking: ${course.name}`;
                let quizSectionHtml = '';
                if (course.quiz && course.quiz.uploaded) {
                    quizSectionHtml = `
                        <h3 class="text-2xl font-semibold text-white mb-2 mt-6 border-b border-gray-700 pb-2">Assessment</h3>
                        <p class="text-gray-400 mb-4">An assessment file has been uploaded for this course.</p>
                        <a href="#" class="inline-block bg-purple-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-purple-700 transition-colors">
                            Download Quiz File
                        </a>
                        <button id="mark-quiz-btn" class="bg-green-600 text-white py-2 px-4 rounded-lg font-semibold mt-4 hover:bg-green-700">
                            Mark Quiz as Complete
                        </button>
                    `;
                } else {
                    quizSectionHtml = `
                        <h3 class="text-2xl font-semibold text-white mb-2 mt-6 border-b border-gray-700 pb-2">Assessment</h3>
                        <p class="text-gray-400">No quiz has been uploaded for this course.</p>
                        <button id="mark-quiz-btn" class="bg-green-600 text-white py-2 px-4 rounded-lg font-semibold mt-4 hover:bg-green-700">
                            Mark This Section as Complete
                        </button>
                    `;
                }

                courseContentContainer.innerHTML = `
                    <h2 class="text-3xl font-bold text-white mb-4 text-center">${course.name}</h2>
                    <p class="text-lg text-gray-300 mb-6 text-center">${course.description}</p>
                    
                    <h3 class="text-2xl font-semibold text-white mb-2 mt-4 border-b border-gray-700 pb-2">Lecture Notes</h3>
                    <img src="${course.generatedImage}" alt="Course Hero Image" class="w-full h-auto rounded-lg mb-4">
                    <p class="text-white mt-2">${course.lecture.content || "No lecture notes provided."}</p>
                    <button id="mark-lecture-btn" class="bg-blue-600 text-white py-2 px-4 rounded-lg font-semibold mt-4 hover:bg-blue-700">
                        Mark Lecture as Read
                    </button>

                    <h3 class="text-2xl font-semibold text-white mb-2 mt-6 border-b border-gray-700 pb-2">Lecture Video & Audio</h3>
                    <p class="text-gray-400">Video Player:</p>
                    <div class="aspect-w-16 aspect-h-9 my-4">
                        <iframe class="w-full rounded-lg" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ?si=iF2s-r9u-I2t7t5A" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
                    </div>
                    <p class="text-gray-400 mt-4">Audio Playback:</p>
                    <audio controls class="w-full my-4 rounded-lg bg-gray-700">
                        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>
                    
                    ${quizSectionHtml}
                `;

                // Initial progress update
                updateProgress();

                const markLectureBtn = document.getElementById('mark-lecture-btn');
                const markQuizBtn = document.getElementById('mark-quiz-btn');

                if (markLectureBtn) {
                    markLectureBtn.addEventListener('click', () => {
                        if (!courseProgress.lectureRead) {
                            courseProgress.lectureRead = true;
                            localStorage.setItem(`progress_${courseId}, JSON.stringify(courseProgress)`);
                            alert("Lecture marked as complete!");
                            updateProgress();
                        }
                    });
                }

                if (markQuizBtn) {
                    markQuizBtn.addEventListener('click', () => {
                        if (!courseProgress.quizCompleted) {
                            courseProgress.quizCompleted = true;
                            localStorage.setItem(`progress_${courseId}, JSON.stringify(courseProgress)`);
                            alert("Quiz section marked as complete!");
                            updateProgress();
                        }
                    });
                }

                generateCertificateBtn.addEventListener('click', () => {
                    const studentName = studentNameInput.value.trim();
                    if (!studentName) {
                        alert("Please enter your name to generate the certificate.");
                        return;
                    }
                    localStorage.setItem(`student_name_${courseId}, studentName`);
                    window.location.href = `certificate.html?courseId=${course.courseId}&studentName=${encodeURIComponent(studentName)}`;
                });

            } else {
                courseContentContainer.innerHTML = '<p class="text-2xl text-red-500 text-center">Course not found.</p>';
            }
        });
    </script>
</body>
</html>